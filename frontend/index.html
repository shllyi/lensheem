<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>LenSheem - Premium Eyewear Collection</title>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<meta name="description" content="Premium eyewear collection">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="assets/images/favicon.png" />
<link rel="stylesheet" href="assets/css/plugins.css">
<link rel="stylesheet" href="assets/css/bootstrap.min.css">
<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/responsive.css">
<style>
/* Modern Formal Styling */
body {
    font-family: 'Helvetica Neue', Arial, sans-serif;
    background-color: #ffffff;
    color: #333;
    line-height: 1.6;
}

.product-section {
    padding: 80px 0;
    background: #ffffff;
}

.section-header {
    margin-bottom: 60px;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 30px;
}

.section-header h2 {
    font-size: 2.5rem;
    font-weight: 300;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #333;
    margin-bottom: 10px;
}

.section-header p {
    font-size: 1.1rem;
    color: #666;
    font-weight: 300;
}

.filter-section {
    margin-bottom: 50px;
    padding: 30px;
    background: #f8f9fa;
    border-radius: 0;
}

.filter-section select {
    border: 1px solid #ddd;
    padding: 12px 20px;
    font-size: 14px;
    background: white;
    border-radius: 0;
    color: #333;
}

.filter-section select:focus {
    border-color: #333;
    box-shadow: none;
}

.product-count {
    font-size: 14px;
    color: #666;
    font-weight: 300;
    letter-spacing: 1px;
}

.product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
    margin-top: 40px;
}

.product-item {
    background: white;
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.product-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border-color: #333;
}

.product-image {
    position: relative;
    height: 300px;
    overflow: hidden;
    background: #f8f9fa;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-item:hover .product-image img {
    transform: scale(1.05);
}

.product-labels {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 2;
}

.product-label {
    background: #333;
    color: white;
    padding: 5px 12px;
    font-size: 11px;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 5px;
    display: block;
}

.product-label.sale {
    background: #d32f2f;
}

.product-label.new {
    background: #2e7d32;
}

.product-content {
    padding: 30px 25px;
    text-align: center;
}

.product-title {
    font-size: 1.1rem;
    font-weight: 400;
    color: #333;
    margin-bottom: 15px;
    letter-spacing: 1px;
    text-transform: uppercase;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-price {
    margin-bottom: 25px;
}

.price-current {
    font-size: 1.3rem;
    font-weight: 500;
    color: #333;
    letter-spacing: 1px;
}

.price-original {
    font-size: 1rem;
    color: #999;
    text-decoration: line-through;
    margin-right: 10px;
}

.product-actions {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
}

.product-item:hover .product-actions {
    opacity: 1;
    transform: translateY(0);
}

.btn-add-cart {
    background: #333;
    color: white;
    border: 1px solid #333;
    padding: 12px 30px;
    font-size: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-weight: 400;
    transition: all 0.3s ease;
    width: 100%;
    border-radius: 0;
    position: relative;
    z-index: 10;
}

.btn-add-cart:hover {
    background: white;
    color: #333;
    border-color: #333;
}

.btn-add-cart:active {
    background: #333;
    color: white;
}

.btn-add-cart.added {
    background: #2e7d32;
    color: white;
    border-color: #2e7d32;
}

.loading-state {
    text-align: center;
    padding: 80px 0;
    color: #666;
}

.loading-spinner {
    font-size: 14px;
    color: #666;
    letter-spacing: 1px;
}

.error-message {
    text-align: center;
    padding: 80px 0;
    color: #666;
}

.error-message i {
    color: #d32f2f;
    margin-bottom: 20px;
}

/* Carousel Styles */
.carousel-control-prev-icon,
.carousel-control-next-icon {
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .product-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
    }
}

@media (max-width: 768px) {
    .product-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .section-header h2 {
        font-size: 2rem;
    }
    
    .product-section {
        padding: 60px 0;
    }
    
    .product-actions {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
</head>

<body class="template-index belle template-index-belle">
    <div id="header"></div>

    <div id="pre-loader">
        <img src="assets/images/loader.gif" alt="Loading..." />
    </div>

    <div class="pageWrapper">
        <div id="page-content">
            <!-- Home slider -->
            <div class="slideshow slideshow-wrapper pb-section sliderFull">
                <div class="home-slideshow">
                    <div class="slide">
                        <div class="blur-up lazyload bg-size">
                            <img class="blur-up lazyload bg-img" data-src="assets/images/slideshow-banners/glasses2.jpg" src="assets/images/slideshow-banners/glasses2.jpg" alt="Shop Our New Collection" title="Shop Our New Collection" />
                            <div class="slideshow__text-wrap slideshow__overlay classic bottom">
                                <div class="slideshow__text-content bottom">
                                    <div class="wrap-caption center">
                                        <h2 class="h1 mega-title slideshow__title">Shop Our New Collection</h2>
                                        <span class="mega-subtitle slideshow__subtitle">From High to Low, Classic or Modern. We Have You Covered</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slide">
                        <div class="blur-up lazyload bg-size">
                            <img class="blur-up lazyload bg-img" data-src="assets/images/slideshow-banners/belle-banner2.jpg" src="assets/images/slideshow-banners/belle-banner2.jpg" alt="Chromaflare Collection" title="Chromaflare Collection" />
                            <div class="slideshow__text-wrap slideshow__overlay classic bottom">
                                <div class="slideshow__text-content bottom">
                                    <div class="wrap-caption center">
                                        <h2 class="h1 mega-title slideshow__title">Chromaflare Collection</h2>
                                        <span class="mega-subtitle slideshow__subtitle">Save up to 50% off this weekend only</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Collection -->
            <div class="product-section">
                <div class="container">
                    <div class="section-header text-center">
                        <h2>Featured Collection</h2>
                        <p>Curated selection of premium eyewear</p>
                    </div>

                    <div class="filter-section">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <select class="form-select" id="categoryFilter">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div class="col-md-6 text-end">
                                <span class="product-count">
                                    <span id="product-count">0</span> Products
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="product-grid" id="productGrid">
                        <div class="loading-state">
                            <div class="loading-spinner">Loading Collection...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/vendor/jquery-3.3.1.min.js"></script>
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery.cookie.js"></script>
    <script src="assets/js/vendor/wow.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/lazysizes.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        // Helper function to parse images (from second code)
        function parseImages(imageField) {
            if (!imageField) return [];
            if (Array.isArray(imageField)) return imageField;
            return [imageField];
        }

        // Helper function to update cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            $('#cart-count').text(cart.length);
        }

        // Load categories function (from second code)
        function loadCategories() {
            $.get('/api/category', function(res) {
                if (res.success && Array.isArray(res.data)) {
                    const $filter = $('#categoryFilter');
                    res.data.forEach(cat => {
                        $filter.append(`<option value="${cat.category_id}">${cat.description}</option>`);
                    });
                } else {
                    console.warn('Failed to load categories.');
                }
            }).fail(() => {
                console.error('Error fetching categories.');
            });
        }

        // Modified loadItems function (combining both codes)
        function loadItems(categoryId = '') {
            $('#productGrid').html('<div class="loading-state"><div class="loading-spinner">Loading Collection...</div></div>');

            const url = categoryId ? `/api/item/category/${categoryId}` : `/api/item`;

            $.get(url, function(res) {
                if (res.status === 'success' || res.success) {
                    const items = res.data;
                    $('#product-count').text(items.length);

                    if (items.length === 0) {
                        $('#productGrid').html(`
                            <div class="error-message">
                                <i class="fas fa-search fa-2x"></i>
                                <p>No products found for the selected category.</p>
                            </div>
                        `);
                        return;
                    }

                    let html = '';
                    items.forEach(item => {
                        // Parse images (from second code)
                        let images = parseImages(item.images || item.image);
                        images = [...new Set(images)]; // Deduplicate
                        
                        // Use item.id or item.item_id depending on API response
                        const itemId = item.id || item.item_id;
                        const itemName = item.item_name;
                        const sellPrice = item.sell_price;
                        
                        // Handle discount logic (from first code)
                        const hasDiscount = item.discount_percentage && item.discount_percentage > 0;
                        const originalPrice = hasDiscount ? (sellPrice / (1 - item.discount_percentage / 100)).toFixed(2) : null;
                        const isNew = item.is_new || false;

                        // Create image HTML with carousel support (from second code)
                        let imageHtml = '';
                        const uniqueCarouselId = `carousel-${itemId}`;
                        
                        if (images.length === 0) {
                            imageHtml = `<img src="https://via.placeholder.com/400x300/f8f9fa/333?text=GLASSES" alt="${itemName}">`;
                        } else if (images.length === 1) {
                            imageHtml = `<img src="/uploads/${images[0]}" alt="${itemName}" onerror="this.src='https://via.placeholder.com/400x300/f8f9fa/333?text=GLASSES'">`;
                        } else {
                            imageHtml = `
                                <div id="${uniqueCarouselId}" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        ${images.map((img, idx) => `
                                            <div class="carousel-item ${idx === 0 ? 'active' : ''}">
                                                <img src="/uploads/${img}" class="d-block w-100" alt="${itemName}" onerror="this.src='https://via.placeholder.com/400x300/f8f9fa/333?text=GLASSES'">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#${uniqueCarouselId}" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#${uniqueCarouselId}" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    </button>
                                </div>
                            `;
                        }

                        html += `
                            <div class="product-item" data-item-id="${itemId}">
                                <div class="product-image">
                                    ${imageHtml}
                                    ${hasDiscount || isNew ? `
                                        <div class="product-labels">
                                            ${hasDiscount ? `<span class="product-label sale">Sale</span>` : ''}
                                            ${isNew ? `<span class="product-label new">New</span>` : ''}
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="product-content">
                                    <h3 class="product-title">${itemName}</h3>
                                    <div class="product-price">
                                        ${originalPrice ? `<span class="price-original">₱${originalPrice}</span>` : ''}
                                        <span class="price-current">₱${parseFloat(sellPrice).toFixed(2)}</span>
                                    </div>
                                    <div class="product-actions">
                                        <button class="btn-add-cart" 
                                                data-id="${itemId}" 
                                                data-name="${itemName}" 
                                                data-price="${sellPrice}"
                                                data-image="${images[0] || 'default.jpg'}">
                                            Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    $('#productGrid').html(html);
                } else {
                    $('#productGrid').html(`
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                            <p>Failed to load products. Please try again.</p>
                        </div>
                    `);
                }
            }).fail(function() {
                $('#productGrid').html(`
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                        <p>Connection error. Please check your network and try again.</p>
                    </div>
                `);
            });
        }

        $(document).ready(function() {
            // Load header (from second code)
            $('#header').load('/header.html', function() {
                const dropdownTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="dropdown"]'));
                dropdownTriggerList.map(function(dropdownTriggerEl) {
                    return new bootstrap.Dropdown(dropdownTriggerEl);
                });

                // Authentication check (from first code)
                const token = localStorage.getItem('token');
                const userId = localStorage.getItem('userId');

                if (token && userId) {
                    $('#login-link, #register-link').addClass('d-none');
                    $('#user-dropdown').removeClass('d-none');

                    $.get(`/api/users/customers/${userId}`, function(res) {
                        if (res.success && res.data) {
                            const data = res.data;
                            const fullName = `${data.fname || ''} ${data.lname || ''}`.trim();
                            $('#username').text(fullName || 'USER');
                            if (data.image_path) {
                                $('.profile-img').attr('src', `/${data.image_path}`);
                            }
                        }
                    }).fail(function() {
                        console.log('Failed to load user data');
                    });
                } else {
                    $('#login-link, #register-link').removeClass('d-none');
                    $('#user-dropdown').addClass('d-none');
                }

                updateCartCount();
            });

            // Load products and categories
            loadItems();
            loadCategories();

            // Category filter
            $('#categoryFilter').on('change', function() {
                loadItems($(this).val());
            });

            // Product click handler - redirect to itemdesc.html
            $(document).on('click', '.product-item', function(e) {
                // Prevent navigation if clicking on the add to cart button
                if ($(e.target).closest('.btn-add-cart').length) {
                    return;
                }
                
                // Prevent navigation if clicking on carousel controls
                if ($(e.target).closest('.carousel-control-prev, .carousel-control-next').length) {
                    return;
                }

                const itemId = $(this).data('item-id');
                if (itemId) {
                    window.location.href = `itemdesc.html?id=${itemId}`;
                }
            });

            // Add to cart (updated from second code)
            $(document).on('click', '.btn-add-cart', function(e) {
                e.stopPropagation(); // Prevent product click event
                
                const token = localStorage.getItem('token');
                const userId = localStorage.getItem('userId');

                if (!token || !userId) {
                    alert('You must be logged in first!');
                    window.location.href = '/login.html';
                    return;
                }

                const $btn = $(this);
                const product = {
                    id: $btn.data('id'),
                    name: $btn.data('name'),
                    price: $btn.data('price'),
                    image_path: $btn.data('image'),
                    quantity: 1
                };

                let cart = JSON.parse(localStorage.getItem('cart')) || [];

                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push(product);
                }

                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();

                $btn.addClass('added').text('Added to Cart');
                
                setTimeout(() => {
                    $btn.removeClass('added').text('Add to Cart');
                }, 2000);
            });

            // Logout
            $('#logout-btn').on('click', function() {
                localStorage.removeItem('token');
                localStorage.removeItem('userId');
                $('#user-dropdown').addClass('d-none');
                $('#login-link, #register-link').removeClass('d-none');
                console.log('User logged out');
            });
        });

        // Newsletter popup script (from first code)
        jQuery(document).ready(function(){  
            jQuery('.closepopup').on('click', function () {
                jQuery('#popup-container').fadeOut();
                jQuery('#modalOverly').fadeOut();
            });
            
            var visits = jQuery.cookie('visits') || 0;
            visits++;
            jQuery.cookie('visits', visits, { expires: 1, path: '/' });
            
            if ( jQuery.cookie('visits') > 1 ) {
                jQuery('#modalOverly').hide();
                jQuery('#popup-container').hide();
            } else {
                var pageHeight = jQuery(document).height();
                jQuery('<div id="modalOverly"></div>').insertBefore('body');
                jQuery('#modalOverly').css("height", pageHeight);
                jQuery('#popup-container').show();
            }
            
            if (jQuery.cookie('noShowWelcome')) { 
                jQuery('#popup-container').hide(); 
                jQuery('#active-popup').hide(); 
            }
        }); 
        
        jQuery(document).mouseup(function(e){
            var container = jQuery('#popup-container');
            if( !container.is(e.target) && container.has(e.target).length === 0) {
                container.fadeOut();
                jQuery('#modalOverly').fadeIn(200);
                jQuery('#modalOverly').hide();
            }
        });
    </script>
</body>
</html>